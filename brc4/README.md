# BRC4 Unpacker

Unpack Brute Ratel (BRC4) stager and extract config

```
% ./brc4_unpack.py 3ad53495851bafc48caf6d2227a434ca2e0bef9ab3bd40abfe4ea8f318d37bbe.exe
entry_point: 0x401000 (raw: 0x200)
searching for tail jump...
tail jump -> 0x43ecb2:	jmp	0x43ee4f
emulating from entry to tail jump...
dumped stage 2 to 3ad53495851bafc48caf6d2227a434ca2e0bef9ab3bd40abfe4ea8f318d37bbe.exe.stage2
config:
 - b'\xba\x00\x00\x00\x00\x00\x00\x000'
 - b'1'
 - b'159.65.186.50'
 - b'443'
 - b'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36'
 - b'2K4TBS7L9GK2C205'
 - b'306TU1OE6RDT9SR1'
 - b'/login,/admin'
 - b''
 - b'\x00\x00\x00\x00\x00\x00'


% ./brc4_unpack.py d71dc7ba8523947e08c6eec43a726fe75aed248dfd3a7c4f6537224e9ed05f6f.exe
entry_point: 0x401000 (raw: 0x200)
searching for tail jump...
tail jump -> 0x41b5d8:	jmp	0x41b765
emulating from entry to tail jump...
dumped stage 2 to d71dc7ba8523947e08c6eec43a726fe75aed248dfd3a7c4f6537224e9ed05f6f.exe.stage2
config:
 - b'K\x00\x00\x00\x00\x00\x00\x000'
 - b'45.77.172.28'
 - b'80'
 - b'trial@deloitte.com.cn'
 - b'Password123'
 - b'abcd@123'
 - b'/content.php'
 - b''
 - b'\x00\x00\x00\x00\x00'
```

2nd stage payloads are extracted too:
```
% file *.stage2
3ad53495851bafc48caf6d2227a434ca2e0bef9ab3bd40abfe4ea8f318d37bbe.exe.stage2: PE32+ executable (DLL) (console) x86-64 (stripped to external PDB), for MS Windows
d71dc7ba8523947e08c6eec43a726fe75aed248dfd3a7c4f6537224e9ed05f6f.exe.stage2: PE32+ executable (DLL) (console) x86-64 (stripped to external PDB), for MS Windows
```
